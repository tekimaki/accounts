package:
  package: accounts
  description: Estabilishes accounts for clustering users and managing access control 
  copyright:
    - {year: 2010, name: Tekimaki LLC, contact: http://tekimaki.com}
    - {year: 2010, name: Will James, contact: will@tekimaki.com}
  license:
    name: LGPL
    description: Licensed under the GNU LESSER GENERAL PUBLIC LICENSE.
    url: http://www.gnu.org/copyleft/lesser.html 
  version: 0.1
  requirements:
    liberty: {min: 2.1.5}
    libertygraph: {min: 0.0.0}
  maintainer_url: http://www.tekimaki.com
  homeable: true 
  pluggable: true
  settings:
    roles:
      account_member_role: {label: Account Member Role, type: int, note: The group_id for the account membership role.}
      project_member_role: {label: Project Member Role, type: int, note: The group_id for the project membership role.}
      account_member_role: {label: Account Member Role, type: int, note: The group_id for the sub-project membership role.}

  services:
    subproject_content:
      name: SubProjectContent
      class_name: SubProjectContent
      description: Stores content within a subproject
      base_class: LibertyBase
      base_package: liberty
      type: subproject_content
      service: subproject_content
      functions: [content_edit, content_store, content_expunge, content_display, content_preview]
      sql: [content_edit_sql]
      templates: [content_edit_mini]
      permissions:
        default: [update: admin]
      relation: one-to-many     # options: one-to-one, one-to-many, many-to-many
      fields:
        subproject_id: 
          name: Sub Projects
          help: Select the sub-projects this content belongs to
          schema: {type: I4, notnull: true}
          validator: {type: reference, table: subproject_data, column: subproject_id, required: true}
          input: {type: select, multiple: true, desc_column: title, desc_table: liberty_content, optionsHashName: availableSubprojects, js: [onchange]}
      constraints:
        CONSTRAINT `scm_subproject_id_ref` FOREIGN KEY (`subproject_id`) REFERENCES `subproject_data` (`subproject_id`)

  types:
    account:
      templates: {list_type.tpl: ulli}
      content_name: Account
      content_name_plural: Accounts
      description: A class which represents an account.
      base_class: LibertyMime
      class_name: BitAccount
      base_package: liberty
      maintainer_url: http://www.tekimaki.com
      attachments: true
      rewrite_path: account
      lookup_by: [title]
      permissions:
        default: {create: admin, update: admin} 
      fields:
        title:
          name: Account Name
        data:
          name: About
          help: A statement about the account.
    project:
      content_name: Project
      content_name_plural: Projects
      templates: {list_type.tpl: ulli}
      description: A class which represents a project.
      base_class: LibertyMime
      class_name: BitProject
      base_package: liberty
      maintainer_url: http://www.tekimaki.com
      attachments: true
      rewrite_path: project
      lookup_by: [title]
      permissions:
        default: {create: admin, update: admin}
      fields:
        title:
          name: Project Name
        data:
          name: Description
          help: A description of the project
        is_default:
          name: Is Default
          schema: {type: I1, notnull: true, default: 0}
          validator: {type: boolean}
          input: {type: none}
        account_id:
          name: Account Name
          schema: {type: I4, notnull: true}
          validator: {type: reference, table: account_data, column: account_id, required: true}
          input: {type: select, desc_column: title, desc_table: liberty_content, optionsHashName: myAccounts }
      constraints:
        CONSTRAINT `account_id_ref` FOREIGN KEY (`account_id`) REFERENCES `account_data` (`account_id`)
    subproject:
      templates: {list_type.tpl: ulli}
      content_name: Sub-Project
      content_name_plural: Sub-Projects
      description: A class which represents a project.
      base_class: LibertyMime
      class_name: BitSubProject
      base_package: liberty
      maintainer_url: http://www.tekimaki.com
      attachments: true
      rewrite_path: project
      lookup_by: [title]
      permissions:
        default: {create: admin, update: admin}
      fields:
        title:
          name: Sub-Project Name
        data:
          name: Description
          help: A description of the sub-project
        account_id:
          name: Account Name
          schema: {type: I4, notnull: true}
          validator: {type: reference, table: account_data, column: account_id, required: true}
          input: {type: select, desc_column: title, desc_table: liberty_content, optionsHashName: myAccounts, js: [onchange]}
        project_id:
          name: Project Name
          schema: {type: I4, notnull: true}
          validator: {type: reference, table: project_data, column: project_id, required: true}
          input: {type: select, desc_column: title, desc_table: liberty_content, optionsHashName:myProjects}
        is_default:
          name: Is Default
          schema: {type: I1, notnull: true, default: 0}
          validator: {type: boolean}
          input: {type: none}
      constraints:
        CONSTRAINT `account_id_ref` FOREIGN KEY (`account_id`) REFERENCES `account_data` (`account_id`)
        CONSTRAINT `project_id_ref` FOREIGN KEY (`project_id`) REFERENCES `project_data` (`project_id`)
  tables:
    users_roles_map:
      description: A map of an account project or subproject to a user and group
      fields:
        group_id: 
          name: Group Id
          schema: {type: I4, primary: true}
          validator: {type: reference, table: users_groups, column: group_id, required: true}
          input: {type: select, desc_column: title, desc_table: liberty_content, optionsHashName: availableGroups, js: [onchange]}
        user_id: 
          name: User Id
          schema: {type: I4, primary: true}
          validator: {type: reference, table: users_users, column: user_id, required: true}
          input: {type: select, desc_column: title, desc_table: liberty_content, optionsHashName: availableUsers, js: [onchange]}
        content_id: 
          name: Content Id
          schema: {type: I4, primary: true}
          validator: {type: reference, table: users_users, column: user_id, required: true, constrain_foreign_column: content_type_guid, constrain_value: {bitaccount, bitproject, bitsubproject} }
          input: {type: select, desc_column: title, desc_table: liberty_content, optionsHashName: availableContent, js: [onchange]}
      constraints:
        CONSTRAINT `urm_group_id` FOREIGN KEY (`group_id`) REFERENCES `users_groups` (`group_id`)
        CONSTRAINT `urm_user_id` FOREIGN KEY (`content_id`) REFERENCES `users_users` (`user_id`)
        CONSTRAINT `urm_content_id_ref` FOREIGN KEY (`content_id`) REFERENCES `liberty_content` (`content_id`)
